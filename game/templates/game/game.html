{% extends 'game/base.html' %}

{% block extra_js %}
    <script type="text/javascript" src="/static/js/paper.js"></script>
    <script type="text/javascript" src="/static/js/entity.js"></script>
    <script type="text/javascript" src="/static/js/game-controls.js"></script>
<script type = "text/javascript">
paper.install(window);
$(function() {
    paper.setup('canvas');

    $('#canvas').css('height', '600px');
    paper.view.viewSize = [700, 600];

    entitySetup();

    var scaleCount = 0; 
    var weight = 1;

    view.onFrame = function(event) {
        snailUpdate();
        player.move();
        player.animateShoot();
    }

    scroll = function(movement) {
        if (!project.activeLayer.translate(movement).bounds.contains(view.center))
            project.activeLayer.translate(movement.multiply(-1));
    }

    tool.onKeyDown = function(event) {
        if (event.key == 'w') {
            player.moveUp();
        }
        if (event.key == 'a') {
            player.moveLeft();
        }
        if (event.key == 's') {
            player.moveDown();
        }
        if (event.key == 'd') {
            player.moveRight();
        }
        if ((event.key == '=') && (scaleCount < 2)) {
            project.activeLayer.scale(1.25, view.center);
            weight *= 0.9;
            scaleCount++;
        }
        if ((event.key == '-') && (scaleCount > -7)) {
            project.activeLayer.scale(0.8, view.center);
            weight *= 1 / 0.9;
            scaleCount--;
        }
        if (event.key == 'right') {
            scroll(new Point(-100 * weight, 0));
        }
        if (event.key == 'left') {
            scroll(new Point(100 * weight, 0));
        }
        if (event.key == 'up') {
            scroll(new Point(0, 100 * weight));
        }
        if (event.key == 'down') {
            scroll(new Point(0, -100 * weight));
        }
        if (event.key == 'n') {
            player.pickUp();
        }
        if (event.key == 'm') {
            player.drop();
        }
        if (event.key == 't') {
            player.barricadeUp();
        }
        if (event.key == 'f') {
            player.barricadeLeft();
        }
        if (event.key == 'g') {
            player.barricadeDown();
        }
        if (event.key == 'h') {
            player.barricadeRight();
        }
        if (event.key == 'i') {
            player.breakBarUp();
        }
        if (event.key == 'j') {
            player.breakBarLeft();
        }
        if (event.key == 'k') {
            player.breakBarDown();
        }
        if (event.key == 'l') {
            player.breakBarRight();
        }

    }

});
</script>
{% endblock %}

{% block content %}
<div id="instructions_modal" class="modal hide">
    <div class="modal-header">
        <h3>Game Instructions</h3>
    </div>
    <div class="modal-body">
        <p>
            <span class="control_key big">=</span> Zoom In<br>
            <span class="control_key big">-</span> Zoom Out<br>
            <span class="control_key big">WASD</span> Move Player<br>
            <span class="control_key big">TFGH</span> Make Barricades<br>
            <span class="control_key big">IJKL</span> Break Barricades<br>
            <span class="control_key big">N</span> Pick Up Ammo Crate<br>
            <span class="control_key big">M</span> Drop Ammo Crate<br>
            <span class="control_key">arrow keys</span> Move Camera
        </p>
    </div>
    <div class="modal-footer">
        <a href="#" class="btn btn-primary btn-success" data-dismiss="modal">Got It!</a>
    </div>
</div>

<img src="/static/img/houseplan.jpg" class="sprite" id="house" />
<img src="/static/img/snail_teeth.png" class="sprite" id="snail" />
<img src="/static/img/muzzle_flash.png" class="sprite" id="muzzleflash" />
<img src="/static/img/ghost.png" class="sprite" id="ghost" />
<img src="/static/img/ghost_gun.png" class="sprite" id="ghostgun" />
<img src="/static/img/ghost_ammobox.png" class="sprite" id="ghostbox" />
<img src="/static/img/ammobox.png" class="sprite" id="ammobox" />
<img src="/static/img/barricade_stairs.png" class="sprite" id="stairBarricade" />
<img src="/static/img/barricade_door.png" class="sprite" id="doorBarricade" />

<!-- Need to have the AJAX requests running as early as possible. -->
<script type="text/javascript" src="/static/js/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="/static/js/bootstrap-modal.js"></script>
<script type="text/javascript" src="/static/js/game-ajax.js"></script>

<canvas id="canvas" class="grid_9 alpha"></canvas>
<div class="grid_3 alpha">
    <div style="padding: 10px; height: 530px">
        <p style="text-align: right">Ammo: <span style="color: green; font-size: 250%">2</span> / 5</p>

        <p>&nbsp;</p>
        {% with 'btn btn-success control_btn_left' as action_left %}
        {% with 'btn btn-success control_btn_right' as action_right %}
        <p>
            <a class="{{ action_left }}" id="btn_move" href="#" data-action="Move">Move</a>
            <a class="{{ action_right }}" id="btn_shoot" href="#" data-action="Shoot">Shoot</a>
        </p>
        <p>
            <a class="{{ action_left }}" id="btn_ammo" href="#" data-action="Ammo">Get Ammo</a>
            <a class="{{ action_right }}" id="btn_reload" href="#" data-action="Reload">Reload</a>
        </p>
        <p>
            <a class="{{ action_left }}" id="btn_barricade" href="#" data-action="Barricade">Barricade</a>
            <a class="{{ action_right }}" id="btn_debarricade" href="#" data-action="Debarricade">Debarricade</a>
        </p>
        {% endwith %}
        {% endwith %}

        <p>&nbsp;</p>
        {% with 'btn btn-success arrow_btn disabled' as arrow %}
        <p>
            <a class="{{ arrow }}" id="btn_arrow_up" href="#" data-direction="Up">
                <i class="icon-arrow-up icon-white"></i>
            </a>
        </p>
        <p>
            <a class="{{ arrow }}" id="btn_arrow_left" href="#" data-direction="Left">
                <i class="icon-arrow-left icon-white"></i>
            </a>
            <a class="{{ arrow }}" id="btn_arrow_go" href="#">
                GO
            </a>
            <a class="{{ arrow }}" id="btn_arrow_right" href="#" data-direction="Right">
                <i class="icon-arrow-right icon-white"></i>
            </a>
        </p>
        <p>
            <a class="{{ arrow }}" id="btn_arrow_down" href="#" data-direction="Down">
                <i class="icon-arrow-down icon-white"></i>
            </a>
        </p>
        {% endwith %}
        <p id="instruction_label"></p>
    </div>

    <div style="padding: 10px">
        <a class="btn btn-success" href="#" id="btn_show_instructions" style="width: 176px">
            <i class="icon-info-sign icon-white"></i> Show Instructions
        </a>
    </div>
</div>
{% endblock %}

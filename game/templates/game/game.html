{% extends 'game/base.html' %}

{% block extra_js %}
    <script type="text/javascript" src="/static/js/game.js"></script>
    <script type="text/javascript" src="/static/js/paper.js"></script>
    <script type="text/javascript" src="/static/js/entity.js"></script>
<script type = "text/javascript">
paper.install(window);
$(function() {
    paper.setup('canvas');

    $('#canvas').css('height', '600px');
    paper.view.viewSize = [700, 600];

    entitySetup();

    //var snail = new SnailGroup(5);
    //var snailmoo = new SnailGroup(5);

    var snailmoo = new SnailGroup(5, floor3Room3);
    //var snailmoo = new Ghost('blue', floor3Room3);

    var scaleCount = 0; 
    var weight = 1;

    view.onFrame = function(event) {
        snailUpdate();
        //snail.move();
        snailmoo.move();
    }

    var click = true;
    tool.onMouseDown = function(event) {
        if (click) {
            //snailmoo.setDestination(mainRoom.position);
            //snail.setDestination(event.point);
        } else {
            //snailmoo.setDestination(event.point);
        }
        click = !click;
    }
    scroll = function(movement) {
        if (!project.activeLayer.translate(movement).bounds.contains(view.center))
            project.activeLayer.translate(movement.multiply(-1));
    }
    
    tool.onKeyDown = function(event) {
        if (event.key == 'w') {
            snailmoo.moveUp();
        }
        if (event.key == 'a') {
            snailmoo.moveLeft();
        }
        if (event.key == 's') {
            snailmoo.moveDown();
        }
        if (event.key == 'd') {
            snailmoo.moveRight();
        }
        if ((event.key == 'i') && (scaleCount < 5)) {
            project.activeLayer.scale(1.25, view.center);
            weight *= 0.8;
            scaleCount++;
        }
        if ((event.key == 'o') && (scaleCount > -10)) {
            project.activeLayer.scale(0.8, view.center);
            weight *= 1.25;
            scaleCount--;
        }
        if (event.key == 'right') {
            scroll(new Point(-100 * weight, 0));
        }
        if (event.key == 'left') {
            scroll(new Point(100 * weight, 0));
        }
        if (event.key == 'up') {
            scroll(new Point(0, 100 * weight));
        }
        if (event.key == 'down') {
            scroll(new Point(0, -100 * weight));
        }
        if (event.key == 'k') {
            snailmoo.pickUp();
        }
        if (event.key == 'l') {
            snailmoo.drop();
        }

    }

});
</script>
{% endblock %}

{% block content %}
<canvas id="canvas" class="grid_9 alpha"></canvas>
<div class="grid_3 alpha">
    <div style="padding: 10px">
        <h3>Game Controls:</h3>
    </div>
    <div style="padding: 10px;">
        <h3>Chat:</h3>
        <div style="height: 100px"></div>
        <p>
            <input type="text" style="width: 110px" id="message_input" />
            <a class="btn btn-danger" href="#">Send</a>
        </p>
    </div>
</div>

<div id="instructions_modal" class="modal hide">
    <div class="modal-header">
        <h3>Game Instructions</h3>
    </div>
    <div class="modal-body">
        <p>Here we need instructions...</p>
    </div>
    <div class="modal-footer">
        <a href="#" class="btn btn-primary btn-danger" data-dismiss="modal">Got It!</a>
    </div>
</div>

<img src="/static/img/snail_teeth.png" class="sprite" id="snail" />
<img src="/static/img/houseplan.jpg" class="sprite" id="house" />
<img src="/static/img/ghost_gun.png" class="sprite" id="ghost" />
<img src="/static/img/ghost_ammobox.png" class="sprite" id="ghostbox" />
<img src="/static/img/ammobox.png" class="sprite" id="ammobox" />
<img src="/static/img/barricade_stairs.png" class="sprite" id="stairBarricade" />
<img src="/static/img/barricade_door.png" class="sprite" id="doorBarricade" />
{% endblock %}
